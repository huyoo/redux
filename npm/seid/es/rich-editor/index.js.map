{"version":3,"sources":["rich-editor/index.jsx"],"names":["__rest","s","e","t","p","Object","prototype","hasOwnProperty","call","indexOf","getOwnPropertySymbols","i","length","propertyIsEnumerable","React","BraftEditor","LocaleReceiver","request","View","polyfill","bLocales","en","RichEditor","props","convertImageToBase64","file","Promise","resolve","reject","reader","FileReader","readAsDataURL","onloadend","result","handleUpload","param","onUpload","mediaUploadServer","host","contextUrl","progress","success","error","fd","FormData","append","post","onUploadProgress","progressEvent","complete","loaded","total","headers","neverCancel","then","data","url","id","err","msg","message","handleChange","editorState","onChange","setState","toHTML","handleMediaValidate","beforeUpload","getControls","readOnly","controls","renderCmp","_","localeCode","_a","language","media","rest","state","localeStr","pasteImage","validateFn","uploadFn","dataSetPolyfill","createEditorState","value","nextProps","Component","defaultProps"],"mappings":"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","sourcesContent":["var __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nimport * as React from 'react';\nimport BraftEditor from 'braft-editor';\nimport LocaleReceiver from '../seid-locale-receiver';\nimport request from '../utils/request';\nimport View from './View';\nimport polyfill from './richEditorPolyfill';\n/** 富文本多语言 */\nconst bLocales = {\n    'zh-cn': 'zh',\n    en: 'en',\n};\nexport default class RichEditor extends React.Component {\n    constructor(props) {\n        super(props);\n        this.convertImageToBase64 = (file) => {\n            return new Promise((resolve, reject) => {\n                try {\n                    const reader = new FileReader();\n                    reader.readAsDataURL(file);\n                    reader.onloadend = function () {\n                        resolve(reader.result);\n                    };\n                }\n                catch (e) {\n                    reject(e);\n                }\n            });\n        };\n        /** 处理上传文件和视频媒体 */\n        this.handleUpload = (param) => {\n            const { onUpload, mediaUploadServer, host, contextUrl } = this.props;\n            const { file, progress, success, error } = param;\n            if (onUpload) {\n                onUpload(param);\n            }\n            else {\n                if (mediaUploadServer) {\n                    const fd = new FormData();\n                    fd.append('file', file);\n                    request\n                        .post(`${host}${contextUrl}/upload`, fd, {\n                        onUploadProgress: (progressEvent) => {\n                            const complete = (progressEvent.loaded / progressEvent.total) * 100;\n                            progress(complete);\n                        },\n                        headers: {\n                            neverCancel: true,\n                        },\n                    })\n                        .then((result) => {\n                        const { data } = result;\n                        if (data && data.length) {\n                            success({\n                                url: `${host}${contextUrl}/download?docId=${data[0].id}`,\n                            });\n                        }\n                    })\n                        .catch((err) => {\n                        error({ msg: err.message });\n                    });\n                }\n                else {\n                    this.convertImageToBase64(param.file)\n                        .then((url) => {\n                        param.success({\n                            url,\n                        });\n                    })\n                        .catch((err) => {\n                        error({ msg: err.message });\n                    });\n                }\n            }\n        };\n        this.handleChange = (editorState) => {\n            const { onChange } = this.props;\n            this.setState({ editorState });\n            if (onChange) {\n                onChange(editorState.toHTML());\n            }\n        };\n        /** 媒体资源上传前的验证回调事件 */\n        this.handleMediaValidate = (file) => {\n            const { beforeUpload } = this.props;\n            if (beforeUpload) {\n                return beforeUpload(file);\n            }\n            return true;\n        };\n        /** 获取编辑器工具栏的控件列表 */\n        this.getControls = () => {\n            const { readOnly, controls } = this.props;\n            if (readOnly) {\n                return [];\n            }\n            return controls;\n        };\n        this.renderCmp = (_, localeCode) => {\n            const _a = this.props, { language, media } = _a, rest = __rest(_a, [\"language\", \"media\"]);\n            const { editorState } = this.state;\n            const localeStr = language || bLocales[localeCode] || 'zh';\n            return (<BraftEditor {...rest} language={localeStr} controls={this.getControls()} value={editorState} media={Object.assign({ \n                // 是否允许直接粘贴剪贴板图片（例如QQ截图等）到编辑器\n                pasteImage: true, validateFn: this.handleMediaValidate, uploadFn: this.handleUpload }, media)} onChange={this.handleChange}/>);\n        };\n        polyfill.dataSetPolyfill();\n        this.state = {\n            editorState: BraftEditor.createEditorState(props.value),\n        };\n    }\n    componentWillReceiveProps(nextProps) {\n        const { value } = this.props;\n        if (value !== nextProps.value) {\n            this.setState({\n                editorState: BraftEditor.createEditorState(nextProps.value),\n            });\n        }\n    }\n    render() {\n        return <LocaleReceiver componentName=\"RichEditor\">{this.renderCmp}</LocaleReceiver>;\n    }\n}\n/** 属性默认值 */\nRichEditor.defaultProps = {\n    readOnly: false,\n    controls: [\n        'undo',\n        'redo',\n        'separator',\n        'font-size',\n        'line-height',\n        'letter-spacing',\n        'separator',\n        'text-color',\n        'bold',\n        'italic',\n        'underline',\n        'strike-through',\n        'separator',\n        'superscript',\n        'subscript',\n        'remove-styles',\n        'emoji',\n        'separator',\n        'text-indent',\n        'text-align',\n        'separator',\n        'headings',\n        'list-ul',\n        'list-ol',\n        'blockquote',\n        'code',\n        'separator',\n        'link',\n        'separator',\n        'hr',\n        'separator',\n        'media',\n        'separator',\n        'clear',\n    ],\n    contextUrl: '/edm-service',\n    host: '',\n    mediaUploadServer: true,\n};\nRichEditor.View = View;\n"],"file":"index.js"}