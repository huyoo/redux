{"version":3,"sources":["download-file-button/index.jsx"],"names":["React","Button","message","SeidLocaleReceiver","defaultLocale","request","blobToFile","res","data","headers","filename","eLink","document","createElement","download","decodeURI","split","style","display","href","URL","createObjectURL","body","appendChild","click","revokeObjectURL","removeChild","DownloadFileButton","arguments","state","complete","setState","loading","handleClick","props","getData","requestMethod","requestConfig","status","error","locale","downloadFailed","Accept","method","responseType","then","renderComponent","buttonText","exportExcel","marginLeft","Component","defaultProps"],"mappings":"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","sourcesContent":["import React from 'react';\nimport Button from 'antd/es/button';\nimport message from 'antd/es/message';\nimport SeidLocaleReceiver from '../seid-locale-receiver';\nimport defaultLocale from './locale';\nimport { request } from '../utils';\nconst blobToFile = (res) => {\n    const { data, headers } = res;\n    const filename = headers['content-disposition'];\n    const eLink = document.createElement('a');\n    eLink.download = decodeURI(filename.split('=')[1]);\n    eLink.style.display = 'none';\n    eLink.href = URL.createObjectURL(data);\n    document.body.appendChild(eLink);\n    eLink.click();\n    URL.revokeObjectURL(eLink.href); // 释放URL 对象\n    document.body.removeChild(eLink);\n};\nclass DownloadFileButton extends React.Component {\n    constructor() {\n        super(...arguments);\n        this.state = {};\n        this.complete = () => {\n            this.setState({ loading: false });\n        };\n        this.handleClick = () => {\n            this.setState({ loading: true }, () => {\n                const { getData, requestMethod, requestConfig } = this.props;\n                if (getData) {\n                    getData((res) => {\n                        if (res.status === 200) {\n                            blobToFile(res);\n                        }\n                        else {\n                            message.error(this.locale.downloadFailed);\n                        }\n                        this.complete();\n                    });\n                }\n                else if (requestConfig) {\n                    request(Object.assign(Object.assign({}, requestConfig), { headers: Object.assign(Object.assign({}, requestConfig.headers), { Accept: 'application/octet-stream;charset=utf-8' }), method: requestMethod, responseType: 'blob' }))\n                        .then(res => {\n                        blobToFile(res);\n                        this.complete();\n                    })\n                        .catch(() => {\n                        this.complete();\n                    });\n                }\n                else {\n                    message.error(this.locale.error);\n                }\n            });\n        };\n        this.renderComponent = (locale) => {\n            const { style, buttonText = locale.exportExcel } = this.props;\n            const { loading } = this.state;\n            this.locale = locale;\n            return (<Button loading={loading} style={style || { marginLeft: 8 }} icon=\"export\" type=\"primary\" onClick={this.handleClick}>\n        {buttonText}\n      </Button>);\n        };\n    }\n    render() {\n        return (<SeidLocaleReceiver componentName=\"DownloadFileButton\" defaultLocale={defaultLocale}>\n        {this.renderComponent}\n      </SeidLocaleReceiver>);\n    }\n}\nDownloadFileButton.defaultProps = {\n    requestMethod: 'get',\n};\nexport default DownloadFileButton;\n"],"file":"index.js"}