{"version":3,"sources":["data-import/index.jsx"],"names":["React","Component","Button","Upload","message","Select","xlsx","uniqueId","ExtTable","downloadFileByALink","ExtModal","getString","LocaleReceiver","defaultLocale","downloadFile","download","Function","strList","split","length","DataImport","props","locale","getColumns","columns","initColumns","dataIndex","title","status","render","text","record","validate","color","concat","handleChangeUploadVisible","uploadVisible","state","setState","fileList","handleChangeDataVisible","dataShowVisible","tableData","validated","handleChange","fileObj","file","remote","files","onChange","beforeUpload","originFileObj","analyzeXlsFile","map","fileItem","uid","response","id","error","filter","item","fileReader","FileReader","_this","readAsBinaryString","onloadend","onLoad","workbook","read","result","type","Sheets","SheetNames","sheet1","jsonObj","utils","sheet_to_json","splice","forEach","key","downloadTemplate","value","templateFileList","tItem","find","i","fileName","currentTemplate","undefined","downloadUrl","name","endsWith","freakCustomRequest","onSuccess","onProgress","percent","Promise","resolve","then","success","validateData","validateFunc","newData","Array","isArray","every","sort","a","b","Error","error1","importData","importFunc","error2","renderComponent","action","selectedTemplate","uploadProps","className","accept","customRequest","fileUpload","templateDownload","v","disabled","marginRight","upload","cancel","list","defaultTemplateFile","nextProps","defaultProps"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport Button from 'antd/es/button';\nimport Upload from 'antd/es/upload';\nimport message from 'antd/es/message';\nimport Select from 'antd/es/select';\nimport xlsx from 'xlsx';\nimport uniqueId from 'lodash/uniqueId';\nimport ExtTable from '../ext-table';\nimport { downloadFileByALink } from '../utils';\nimport ExtModal from '../ext-modal';\nimport { getString } from '../_util/utils';\nimport LocaleReceiver from '../seid-locale-receiver';\nimport defaultLocale from './locale';\nconst downloadFile = (download) => {\n    if (!download) {\n        return;\n    }\n    if (download instanceof Function) {\n        download();\n        return;\n    }\n    const strList = download.split('/');\n    downloadFileByALink(download, strList[strList.length - 1]);\n};\nclass DataImport extends Component {\n    constructor(props) {\n        super(props);\n        this.locale = { locale: 'zh-cn' };\n        this.getColumns = (locale) => {\n            const { columns } = this.props;\n            const initColumns = [\n                {\n                    dataIndex: 'status',\n                    title: locale.status,\n                    render: (text, record) => {\n                        if (record.validate) {\n                            return <div style={{ color: 'green' }}>{text}</div>;\n                        }\n                        return <div style={{ color: 'red' }}>{text}</div>;\n                    },\n                },\n                {\n                    dataIndex: 'message',\n                    title: locale.message,\n                },\n            ];\n            return initColumns.concat(columns);\n        };\n        this.handleChangeUploadVisible = () => {\n            const { uploadVisible } = this.state;\n            this.setState({ uploadVisible: !uploadVisible, fileList: [] });\n        };\n        this.handleChangeDataVisible = () => {\n            const { dataShowVisible } = this.state;\n            if (dataShowVisible) {\n                this.setState({ dataShowVisible: false, fileList: [], tableData: [], validated: false });\n                return;\n            }\n            this.setState({ dataShowVisible: !dataShowVisible });\n        };\n        this.handleChange = (fileObj) => {\n            const { file, fileList } = fileObj;\n            const { remote } = this.state;\n            let files;\n            const { onChange } = this.props;\n            if (!this.beforeUpload(file)) {\n                return;\n            }\n            if (file.status === 'done') {\n                // 上传成功后，隐藏上传按钮，如果是remote, 执行查询，展示数据。\n                if (remote) {\n                    // empty TODO::上传至远程服务器\n                }\n                else {\n                    // 如果不是remote, 解析excle, 保存数据并展示，展示数据。\n                    const { originFileObj } = file;\n                    this.analyzeXlsFile(originFileObj);\n                }\n            }\n            files = fileList.map(fileItem => {\n                if (fileItem.status === 'done') {\n                    fileItem.uid = fileItem.response[0].id;\n                }\n                return fileItem;\n            });\n            if (file.status === 'error') {\n                message.error('');\n                files = fileList.filter((item) => item.status !== 'error');\n            }\n            if (onChange) {\n                onChange(Object.assign(Object.assign({}, fileObj), { fileList: files }));\n            }\n            if (!('fileList' in this.props)) {\n                this.setState({ fileList: files });\n            }\n        };\n        this.analyzeXlsFile = (originFileObj) => {\n            const fileReader = new FileReader();\n            const _this = this;\n            if (originFileObj) {\n                fileReader.readAsBinaryString(originFileObj);\n                fileReader.onloadend = function onLoad() {\n                    const workbook = xlsx.read(this.result, { type: 'binary' });\n                    const { Sheets, SheetNames } = workbook;\n                    if (SheetNames && SheetNames.length) {\n                        const sheet1 = Sheets[SheetNames[0]];\n                        const jsonObj = xlsx.utils.sheet_to_json(sheet1);\n                        // 删除第一行数据(固定为题头)\n                        jsonObj.splice(0, 1);\n                        jsonObj.forEach((item) => (item.key = uniqueId()));\n                        _this.setState({ tableData: jsonObj, dataShowVisible: true, uploadVisible: false });\n                    }\n                };\n            }\n        };\n        this.downloadTemplate = (value) => {\n            const { templateFileList = [] } = this.props;\n            if (value) {\n                const tItem = templateFileList.find(i => i.key === value || i.fileName === value);\n                this.setState({ currentTemplate: tItem });\n                if (tItem) {\n                    const { download } = tItem;\n                    downloadFile(download);\n                }\n                return;\n            }\n            const { currentTemplate } = this.state;\n            const item = currentTemplate || (templateFileList.length ? templateFileList[0] : { download: undefined });\n            const { download: downloadUrl } = item;\n            downloadFile(downloadUrl);\n        };\n        this.beforeUpload = (file) => {\n            return (file.type === 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' ||\n                file.type === 'application/vnd.ms-excel' ||\n                file.name.endsWith('.xls') ||\n                file.name.endsWith('.xlsx'));\n        };\n        this.freakCustomRequest = ({ file, onSuccess, onProgress }) => {\n            onProgress({ percent: 100, status: 'uploading' }, file);\n            new Promise(resolve => {\n                resolve();\n            }).then(() => {\n                onSuccess([{ success: true, id: '-1' }], file);\n            });\n        };\n        this.validateData = () => {\n            const { tableData } = this.state;\n            const { validateFunc } = this.props;\n            if (tableData && tableData.length && validateFunc) {\n                let newData = validateFunc(tableData);\n                if (newData && Array.isArray(newData) && tableData.length === newData.length) {\n                    const validated = newData.every(item => item.validate);\n                    if (!validated) {\n                        newData = newData.sort((a, b) => {\n                            if (a.validate && !b.validate)\n                                return 1;\n                            if (!a.validate && b.validate)\n                                return -1;\n                            return 0;\n                        });\n                    }\n                    this.setState({ validated, tableData: newData });\n                }\n                else {\n                    throw new Error(this.locale.error1);\n                }\n            }\n        };\n        this.importData = () => {\n            const { tableData, validated } = this.state;\n            if (validated) {\n                const { importFunc } = this.props;\n                if (importFunc) {\n                    importFunc([...tableData]);\n                }\n                this.setState({ dataShowVisible: false, tableData: [] });\n            }\n            else {\n                message.error(this.locale.error2);\n            }\n        };\n        this.renderComponent = (locale) => {\n            const { templateFileList, action } = this.props;\n            this.locale = locale;\n            const { uploadVisible, fileList = [], tableData, dataShowVisible, validated, selectedTemplate, } = this.state;\n            const columns = this.getColumns(locale);\n            const uploadProps = {\n                className: 'list',\n                accept: '.xls,.xlsx,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',\n                onChange: this.handleChange,\n                beforeUpload: this.beforeUpload,\n                fileList,\n                customRequest: action ? undefined : this.freakCustomRequest,\n            };\n            return (<>\n        <Button type=\"primary\" onClick={this.handleChangeUploadVisible}>\n          {locale.import}\n        </Button>\n        <ExtModal width={720} title={locale.fileUpload} destroyOnClose onCancel={this.handleChangeUploadVisible} visible={uploadVisible}>\n          <div className=\"template-download\">\n            <span>{locale.templateDownload}:</span>\n            <Select value={selectedTemplate} dropdownMatchSelectWidth={false} className=\"select\" allowClear={false} onChange={(v) => this.setState({ selectedTemplate: v })}>\n              {templateFileList.map(item => (<Select.Option key={item.key || item.fileName} value={item.key || item.fileName}>\n                  {item.fileName}\n                </Select.Option>))}\n            </Select>\n            <Button type=\"primary\" onClick={() => this.downloadTemplate()}>\n              {locale.download}\n            </Button>\n          </div>\n          <Upload {...uploadProps}>\n            <div className=\"upload-tool-bar\">\n              {!fileList.length && (<Button disabled={uploadProps.disabled} type=\"primary\" icon=\"upload\" style={{ marginRight: 5 }}>\n                  {locale.upload}\n                </Button>)}\n            </div>\n          </Upload>\n        </ExtModal>\n        <ExtModal width=\"98%\" visible={dataShowVisible} title={locale.validateData} okText={validated ? locale.import : locale.validate} cancelText={locale.cancel} onOk={validated ? this.importData : this.validateData} onCancel={this.handleChangeDataVisible}>\n          <ExtTable rowSelection={false} columns={columns} data={{ list: tableData }}/>\n        </ExtModal>\n      </>);\n        };\n        const { action, customRequest, templateFileList } = props;\n        const defaultTemplateFile = templateFileList && templateFileList.length\n            ? templateFileList[0]\n            : {\n                key: undefined,\n                fileName: undefined,\n                download: '',\n            };\n        this.state = {\n            tableData: [],\n            uploadVisible: false,\n            remote: !!(action || customRequest),\n            selectedTemplate: getString(defaultTemplateFile.key || defaultTemplateFile.fileName),\n        };\n    }\n    static getDerivedStateFromProps(nextProps) {\n        if (nextProps.fileList) {\n            return {\n                fileList: nextProps.fileList,\n            };\n        }\n        return null;\n    }\n    render() {\n        return (<LocaleReceiver componentName=\"DataImport\" defaultLocale={defaultLocale}>\n        {this.renderComponent}\n      </LocaleReceiver>);\n    }\n}\nDataImport.defaultProps = {\n    templateFileList: [],\n    columns: [],\n};\nexport default DataImport;\n"],"file":"index.js"}