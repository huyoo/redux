{"version":3,"sources":["data-export/index.jsx"],"names":["__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","__rest","s","t","p","Object","prototype","hasOwnProperty","call","indexOf","getOwnPropertySymbols","i","length","propertyIsEnumerable","React","Button","xlsx","omit","pick","moment","downloadFileByALink","request","requestData","requestParams","string2Blob","content","Blob","type","downloadFile","url","saveName","URL","createObjectURL","generateFile","exportType","data","sheetName","filename","filenameFormat","sheet","utils","json_to_sheet","workbook","book_new","book_append_sheet","writeFile","format","sheet_to_csv","blob","DataExport","props","explainResponse","exportData","ExportButton","_a","names","buttonProps","exportProps"],"mappings":"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","sourcesContent":["var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nimport React from 'react';\nimport Button from 'antd/es/button';\nimport xlsx from 'xlsx';\nimport omit from 'lodash/omit';\nimport pick from 'lodash/pick';\nimport moment from 'moment';\nimport { downloadFileByALink, request } from '../utils';\n// 请求数据\nconst requestData = (requestParams) => __awaiter(void 0, void 0, void 0, function* () {\n    return request(Object.assign({}, requestParams));\n});\nconst string2Blob = (content) => {\n    return new Blob([content], { type: 'application/octet-stream' });\n};\nconst downloadFile = (url, saveName) => {\n    if (typeof url === 'object' && url instanceof Blob) {\n        url = URL.createObjectURL(url); // 创建blob地址\n    }\n    downloadFileByALink(url, saveName);\n};\n// 生成文件\nconst generateFile = (exportType, data, sheetName = 'Sheet1', filename, filenameFormat) => {\n    if (exportType === 'xlsx') {\n        const sheet = xlsx.utils.json_to_sheet(data);\n        const workbook = xlsx.utils.book_new();\n        xlsx.utils.book_append_sheet(workbook, sheet, sheetName);\n        xlsx.writeFile(workbook, `${filename ? `${filename}.` : ''}${moment().format(filenameFormat)}.xlsx`);\n    }\n    else {\n        const sheet = xlsx.utils.json_to_sheet(data);\n        const content = xlsx.utils.sheet_to_csv(sheet);\n        const blob = string2Blob(content);\n        downloadFile(blob, `${filename ? `${filename}.` : ''}${moment().format(filenameFormat)}.txt`);\n    }\n};\nconst DataExport = (props) => __awaiter(void 0, void 0, void 0, function* () {\n    const { requestParams, data, filename, sheetName, explainResponse, exportType = 'xlsx', filenameFormat = 'YYYYMMDDHHmmss', } = props;\n    let exportData = data;\n    if (requestParams) {\n        exportData = yield requestData(requestParams);\n        if (explainResponse) {\n            exportData = explainResponse(exportData);\n        }\n    }\n    generateFile(exportType, exportData, sheetName, filename, filenameFormat);\n});\nexport const ExportButton = (_a) => {\n    var props = __rest(_a, []);\n    const names = [\n        'requestParams',\n        'data',\n        'filename',\n        'sheetName',\n        'explainResponse',\n        'exportType',\n        'filenameFormat',\n    ];\n    const buttonProps = omit(props, names);\n    const exportProps = pick(props, names);\n    return <Button {...buttonProps} onClick={() => DataExport(exportProps)}/>;\n};\nDataExport.Button = ExportButton;\nexport default DataExport;\n"],"file":"index.js"}