{"version":3,"sources":["select-data/index.jsx"],"names":["React","Component","message","Select","Spin","debounce","get","isEqual","isUndefined","isEmpty","isNotEmpty","defaultLocale","SeidLocaleReceiver","Option","SelectData","props","handleCallBack","err","res","lists","setState","fetching","body","data","optionId","optionCode","optionName","ok","success","forEach","item","push","id","code","name","itemData","length","locale","disabled","error","handleFocus","state","params","propsParams","fetch","handleChange","option","value","undefined","triggerChange","children","dataitem","changedValue","onChange","getData","showLabel","showCode","onlyCode","filterOption","input","indexOf","renderCom","showSearch","dropdownMatchSelectWidth","allowClear","showArrow","className","placeholder","options","map","d","width","nextProps"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport message from 'antd/es/message';\nimport Select from 'antd/es/select';\nimport Spin from 'antd/es/spin';\nimport debounce from 'lodash/debounce';\nimport get from 'lodash/get';\nimport isEqual from 'lodash/isEqual';\nimport isUndefined from 'lodash/isUndefined';\nimport { isEmpty, isNotEmpty } from '../_util/utils';\nimport defaultLocale from './locale';\nimport SeidLocaleReceiver from '../seid-locale-receiver';\nconst { Option } = Select;\n/**\n * 主数据下拉选项\n */\nclass SelectData extends Component {\n    constructor(props) {\n        super(props);\n        this.handleCallBack = (err, res) => {\n            const lists = [];\n            this.setState({\n                fetching: false,\n            });\n            if (isEmpty(err)) {\n                const { body: { data = [] }, } = res;\n                const { optionId, optionCode, optionName } = this.props;\n                if (res.ok && res.body.success) {\n                    if (isNotEmpty(data)) {\n                        data.forEach((item) => {\n                            lists.push({\n                                id: optionId ? get(item, optionId) : item.id,\n                                code: optionCode ? get(item, optionCode) : item.code,\n                                name: optionName ? get(item, optionName) : item.name,\n                                itemData: item,\n                            });\n                        });\n                    }\n                    this.setState({\n                        data: lists.length === 0\n                            ? [{ id: '1', code: 'INIT', name: get(this.locale, 'notFound'), disabled: true }]\n                            : lists,\n                    });\n                }\n                else {\n                    this.setState({\n                        data: [{ id: '1', code: 'INIT', name: get(this.locale, 'notFound'), disabled: true }],\n                    });\n                    message.error(res.body.message === null ? get(this.locale, 'serverError') : res.body.message);\n                }\n            }\n            else {\n                this.setState({\n                    data: [{ id: '1', code: 'INIT', name: get(this.locale, 'notFound'), disabled: true }],\n                });\n                message.error(get(this.locale, 'loadError'));\n            }\n        };\n        this.handleFocus = () => {\n            const { data, params } = this.state;\n            const { params: propsParams = {} } = this.props;\n            if (!isEqual(params, propsParams) || !data || data.length === 0 || data[0].id === '1') {\n                this.setState({\n                    data: [],\n                });\n                this.fetch();\n            }\n        };\n        this.handleChange = (code, option) => {\n            const { value } = this.props;\n            // 选择相同的值不触发change事件\n            if (isNotEmpty(value) && isNotEmpty(value.code) && value.code === code)\n                return;\n            if (isEmpty(code) || isEmpty(option)) {\n                // 清除掉值时\n                this.setState({ name: undefined });\n                this.triggerChange(null);\n                return;\n            }\n            if (!('value' in this.props)) {\n                this.setState({\n                    name: option.props.children,\n                });\n            }\n            this.triggerChange({\n                code: code || undefined,\n                name: option ? option.props.children : undefined,\n                id: option ? option.props.id : undefined,\n                itemData: option ? option.props.dataitem : undefined,\n            });\n        };\n        this.triggerChange = (changedValue) => {\n            const { onChange } = this.props;\n            if (onChange) {\n                onChange(isUndefined(changedValue) ? null : Object.assign({}, changedValue));\n            }\n        };\n        this.fetch = () => {\n            const { getData, params = {} } = this.props;\n            if (!getData)\n                return;\n            this.setState({\n                data: [],\n                fetching: true,\n                params,\n            }, () => {\n                getData(params, this.handleCallBack);\n            });\n        };\n        this.showLabel = (item) => {\n            const { showCode = true, onlyCode = false } = this.props;\n            // 只显示name\n            if (!showCode) {\n                return item.name;\n            }\n            // 只显示code\n            if (onlyCode) {\n                return item.code;\n            }\n            return `${item.code}-${item.name}`;\n        };\n        this.filterOption = (input, option) => option.props.children.indexOf(input) >= 0;\n        this.renderCom = (locale) => {\n            this.locale = locale;\n            const { name, data, fetching } = this.state;\n            const { showSearch = true, disabled, dropdownMatchSelectWidth = true, allowClear = true, showArrow = true, className = '', placeholder = get(locale, 'selectPlaceholder'), } = this.props;\n            const options = data\n                ? data.map(d => (<Option key={d.id} value={d.code} disabled={d.disabled}>\n            {this.showLabel(d)}\n          </Option>))\n                : null;\n            return (<Select style={{ width: '100%' }} disabled={disabled} placeholder={placeholder} dropdownMatchSelectWidth={dropdownMatchSelectWidth} value={name} showSearch={showSearch} showArrow={showArrow} allowClear={allowClear} defaultActiveFirstOption={false} filterOption={this.filterOption} onChange={this.handleChange} onFocus={this.handleFocus} notFoundContent={fetching ? <Spin size=\"small\"/> : null} className={className}>\n        {options}\n      </Select>);\n        };\n        const value = props.value || {};\n        this.fetch = debounce(this.fetch, 200);\n        this.state = {\n            name: value.name,\n            data: [],\n            fetching: false,\n        };\n    }\n    static getDerivedStateFromProps(nextProps) {\n        if ('value' in nextProps) {\n            if (!nextProps.value) {\n                return { name: undefined, code: undefined };\n            }\n            // 清空form表单的值\n            const { name } = nextProps.value;\n            if (!name)\n                return { name: undefined, code: undefined };\n            return Object.assign({}, (nextProps.value || {}));\n        }\n        return null;\n    }\n    render() {\n        return (<SeidLocaleReceiver defaultLocale={defaultLocale} componentName=\"SelectData\">\n        {this.renderCom}\n      </SeidLocaleReceiver>);\n    }\n}\nexport default SelectData;\n"],"file":"index.js"}